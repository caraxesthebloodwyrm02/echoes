name: Production Monitoring

on:
  schedule:
    # Run daily at 9 AM instead of hourly
    - cron: '0 9 * * *'
  workflow_dispatch:
    inputs:
      check_type:
        description: 'Type of check to run'
        required: false
        default: 'all'
        type: choice
        options:
          - all
          - security
          - dependencies

jobs:
  security-check:
    name: Security Check
    runs-on: ubuntu-latest
    if: github.event.inputs.check_type == 'all' || github.event.inputs.check_type == 'security' || github.event.inputs.check_type == ''
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install security tools
        run: |
          pip install pip-audit safety bandit

      - name: Run security scans
        run: |
          echo "ðŸ”’ Running security scans..."
          pip-audit --format json || echo "pip-audit completed with warnings"
          safety check --json || echo "safety scan completed with warnings"
          bandit -r . -f json || echo "bandit scan completed with warnings"
          echo "âœ… Security check completed"

  dependency-check:
    name: Dependency Check
    runs-on: ubuntu-latest
    if: github.event.inputs.check_type == 'all' || github.event.inputs.check_type == 'dependencies' || github.event.inputs.check_type == ''
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Check for outdated dependencies
        run: |
          echo "ðŸ“¦ Checking for dependency updates..."
          pip install pip-tools
          pip list --outdated --format=json || echo "Dependency check completed"
          echo "âœ… Dependency check completed"
